!function(t){function e(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};e.m=t,e.c=n,e.d=function(t,n,o){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=1)}([function(t,e,n){"use strict";function o(t,e){var n=0;if(t.parentNode)for(var o=0,r=t.parentNode.childNodes;o<r.length;o++){var i=r[o];if(i instanceof Element){if(t===i)break;i.hasAttribute(e)&&n++}}return n}function r(t,e){t.classList.contains(e)?t.classList.remove(e):t.classList.add(e)}function i(t){return o(t,"data-item-id")}function a(t){return o(t,"data-id")}function u(t){if(t.hasAttribute("data-token")||t.hasAttribute("data-layout-id")||t.hasAttribute("data-id"))return new d(t.getAttribute("data-id"),t.getAttribute("data-container"),t,t.getAttribute("data-token"),t.getAttribute("data-layout-id")||t.getAttribute("data-id"));throw"element is not a container, or is not initialized properly"}var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.getContainerCount=function(t){for(var e=0,n=0,o=t.childNodes;n<o.length;n++){var r=o[n];r instanceof Element&&(r.hasAttribute("data-id")||r.hasAttribute("data-item-type"))&&e++}return e};var l;!function(t){t.Column="vbox",t.Horizontal="hbox",t.Layout="Layout"}(l=e.ContainerType||(e.ContainerType={})),e.getContainer=u,e.getItem=function(t){if(t.hasAttribute("data-item-id"))return new c(t.getAttribute("data-id")||t.getAttribute("data-item-id"),t.getAttribute("data-item-type")||"null",!t.hasAttribute("data-id"),t);throw"element is not an item"};var c=function(){function t(t,e,n,o){this.id=t,this.type=e,this.readonly=n,this.element=o}return t.prototype.getPosition=function(){return i(this.element)},t.prototype.toggleCollapse=function(){r(this.element,"collapsed")},t.prototype.findParentElement=function(){for(var t=this.element;t.parentElement;)if((t=t.parentElement).hasAttribute("data-id"))return t;throw"Parent has not identifier"},t.prototype.getParentContainer=function(){return u(this.findParentElement())},t.prototype.findParentId=function(){return this.findParentElement().getAttribute("data-id")||""},t.DefaultStyle="_default",t}();e.Item=c;var d=function(t){function e(e,n,o,r,i){var a=t.call(this,e,n,n===l.Horizontal,o)||this;return a.layoutId=i,a.token=r,a}return s(e,t),e.prototype.getPosition=function(){return a(this.element)},e}(c);e.Container=d},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(2),r=(n.n(o),n(3));n.n(r)},function(t,e){},function(t,e,n){"use strict";var o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();Object.defineProperty(e,"__esModule",{value:!0}),n(4);var r,i=n(5),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.init=function(e){t.prototype.init.call(this,e),Drupal.attachBehaviors(e)},e.prototype.initNoBehaviors=function(e){t.prototype.init.call(this,e)},e}(n(6).State);Drupal.behaviors.Layout={attach:function(t,e){r||(r=new a(new i.AjaxLayoutHandler(e.basePath,e.layout.destination))),r.initNoBehaviors(t)}}},function(t,e,n){"use strict"},function(t,e,n){"use strict";var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))(function(r,i){function a(t){try{s(o.next(t))}catch(t){i(t)}}function u(t){try{s(o.throw(t))}catch(t){i(t)}}function s(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(a,u)}s((o=o.apply(t,e||[])).next())})},r=this&&this.__generator||function(t,e){function n(t){return function(e){return o([t,e])}}function o(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(a=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,i=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(a=s.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){s.label=n[1];break}if(6===n[0]&&s.label<a[1]){s.label=a[1],a=n;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(n);break}a[2]&&s.ops.pop(),s.trys.pop();continue}n=e.call(t,s)}catch(t){n=[6,t],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,i,a,u,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return u={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u};Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(0);!function(t){t.Add="layout/ajax/add-item",t.AddColumn="layout/ajax/add-column",t.AddColumnContainer="layout/ajax/add-column-container",t.GetAllowedStyles="layout/ajax/get-styles",t.Move="layout/ajax/move",t.Remove="layout/ajax/remove",t.Render="layout/ajax/render",t.SetStyle="layout/ajax/set-style"}(i||(i={}));var u=function(){function t(t,e){this.baseUrl=t,this.destination=e}return t.prototype.buildFormData=function(t){var e=new FormData;for(var n in t)e.append(n,t[n]);return e},t.prototype.request=function(t,e){var n=this;return new Promise(function(o,r){var i=new XMLHttpRequest;i.open("POST",n.baseUrl+t),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.addEventListener("load",function(){200!==this.status?r(this.status+": "+this.statusText):o(i)}),i.addEventListener("error",function(){r(this.status+": "+this.statusText)}),i.send(n.buildFormData(e))})},t.prototype.createElementFromResponse=function(t){var e=JSON.parse(t.responseText);if(!e||!e.success||!e.output)throw t.status+": "+t.statusText+": got invalid response data";var n=document.createElement("div");if(n.innerHTML=e.output,!(n.firstElementChild instanceof Element))throw t.status+": "+t.statusText+": got invalid response html output";return n.firstElementChild},t.prototype.debug=function(t){console.log("layout error: "+t)},t.prototype.addColumn=function(t,e,n,a){return o(this,void 0,void 0,function(){var o;return r(this,function(r){switch(r.label){case 0:return[4,this.request(i.AddColumn,{token:t,layout:e,containerId:n,position:a||0,destination:this.destination})];case 1:return o=r.sent(),[2,this.createElementFromResponse(o)]}})})},t.prototype.addColumnContainer=function(t,e,n,u,s,l){return o(this,void 0,void 0,function(){var o;return r(this,function(r){switch(r.label){case 0:return[4,this.request(i.AddColumnContainer,{token:t,layout:e,containerId:n,position:u,columnCount:s||2,style:l||a.Item.DefaultStyle,destination:this.destination})];case 1:return o=r.sent(),[2,this.createElementFromResponse(o)]}})})},t.prototype.addItem=function(t,e,n,u,s,l,c){return o(this,void 0,void 0,function(){var o;return r(this,function(r){switch(r.label){case 0:return[4,this.request(i.Add,{token:t,layout:e,containerId:n,itemType:u,itemId:s,position:l,style:c||a.Item.DefaultStyle,destination:this.destination})];case 1:return o=r.sent(),[2,this.createElementFromResponse(o)]}})})},t.prototype.getAllowedStyles=function(t,e,n){return o(this,void 0,void 0,function(){var o,a;return r(this,function(r){switch(r.label){case 0:return[4,this.request(i.GetAllowedStyles,{token:t,layout:e,itemId:n,destination:this.destination})];case 1:if(o=r.sent(),!(a=JSON.parse(o.responseText))||!a.success||!a.styles)throw o.status+": "+o.statusText+": got invalid response data";return[2,a.styles]}})})},t.prototype.moveItem=function(t,e,n,a,u){return o(this,void 0,void 0,function(){return r(this,function(o){switch(o.label){case 0:return[4,this.request(i.Move,{token:t,layout:e,containerId:n,itemId:a,newPosition:u,destination:this.destination})];case 1:return o.sent(),[2]}})})},t.prototype.removeItem=function(t,e,n){return o(this,void 0,void 0,function(){return r(this,function(o){switch(o.label){case 0:return[4,this.request(i.Remove,{token:t,layout:e,itemId:n,destination:this.destination})];case 1:return o.sent(),[2]}})})},t.prototype.renderItem=function(t,e,n){return o(this,void 0,void 0,function(){var o;return r(this,function(r){switch(r.label){case 0:return[4,this.request(i.Render,{token:t,layout:e,itemId:n,destination:this.destination})];case 1:return o=r.sent(),[2,this.createElementFromResponse(o)]}})})},t.prototype.setStyle=function(t,e,n,a){return o(this,void 0,void 0,function(){var o;return r(this,function(r){switch(r.label){case 0:return[4,this.request(i.SetStyle,{token:t,layout:e,itemId:n,style:a||null,destination:this.destination})];case 1:return o=r.sent(),[2,this.createElementFromResponse(o)]}})})},t}();e.AjaxLayoutHandler=u},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),r=n(7),i=function(){function t(t){var e=this;this.containers=[],this.handler=t,this.drake=dragula({copy:function(t,e){try{return o.getContainer(e).readonly||o.getItem(t).readonly}catch(t){return!1}},accepts:function(t,e){try{return!o.getContainer(e).readonly}catch(t){return!1}},invalid:function(t){for(var e=t;e;){if(e.hasAttribute("data-menu"))return!0;if(e.hasAttribute("data-item-id"))return!1;if(!e.parentElement)break;e=e.parentElement}return!0},revertOnSpill:!0,removeOnSpill:!1,direction:"vertical"}),this.drake.on("drop",function(t,n,o,r){e.onDrop(t,n,o,r)}),this.drake.on("over",function(t,n){e.onOver(t,n)})}return t.prototype.remove=function(t){var e=this.drake.containers.indexOf(t);-1!==e&&this.drake.containers.splice(e),t.parentElement&&t.parentElement.removeChild(t)},t.prototype.cancel=function(t,e){t&&this.handler.debug(t),e&&e.remove(),this.drake.cancel(!0)},t.prototype.onOver=function(t,e){t instanceof HTMLElement&&(t.style.cssFloat="none")},t.prototype.onDrop=function(t,e,n,r){var i=this;try{var a=o.getContainer(e),u=o.getItem(t);if(a.readonly)throw"container is readonly";u.readonly?this.handler.addItem(a.token,a.layoutId,a.id,u.type,u.id,u.getPosition()).then(function(e){t.parentElement.replaceChild(e,t),i.initItem(e,a),i.init(e)}).catch(function(e){i.cancel(e,t)}):this.handler.moveItem(a.token,a.layoutId,a.id,u.id,u.getPosition()).catch(function(e){i.cancel(e,t)})}catch(t){this.cancel(t)}},t.prototype.init=function(t){this.collectLayouts(t),this.collectSources(t)},t.prototype.initContainer=function(t,e){if(!t.hasAttribute("droppable")&&t.hasAttribute("data-container")&&t.hasAttribute("data-id")){t.setAttribute("data-token",e.token),t.setAttribute("data-layout-id",e.layoutId);var n=o.getContainer(t);n.type!==o.ContainerType.Horizontal&&(t.setAttribute("droppable","1"),this.drake.containers.push(n.element)),this.collectItems(n),r.createMenu(this,n)}},t.prototype.initItem=function(t,e){if(!t.hasAttribute("draggable")&&t.hasAttribute("data-item-id")){var n=o.getItem(t);t.setAttribute("draggable","1"),n.readonly||r.createMenu(this,n)}},t.prototype.collectSources=function(t){for(var e=0,n=t.querySelectorAll("[data-layout-source]");e<n.length;e++){var o=n[e];this.drake.containers.push(o)}},t.prototype.collectItems=function(t){for(var e=0,n=t.element.childNodes;e<n.length;e++){var o=n[e];o instanceof Element&&(o.hasAttribute("data-item-id")?this.initItem(o,t):this.initContainer(o,t))}},t.prototype.collectLayouts=function(t){for(var e=0,n=t.querySelectorAll("[data-layout]");e<n.length;e++){var i=n[e];if(i.hasAttribute("data-token")&&i.hasAttribute("data-id")){var a=o.getContainer(i);i.setAttribute("droppable","1"),this.drake.containers.push(a.element),this.collectItems(a),r.createMenu(this,a)}}},t}();e.State=i},function(t,e,n){"use strict";function o(t){if(m.length)for(var e=0,n=m;e<n.length;e++){var o=n[e];t.target instanceof Node&&o.element.contains(t.target)||o.close()}}function r(){if(m.length)for(var t=0,e=m;t<e.length;t++)e[t].close()}function i(t,e,n,o){var i=document.createElement("li"),a=document.createElement("a");return a.setAttribute("href","#"),a.setAttribute("role","button"),n&&(a.innerHTML+=f.replace("__GLYPH__",n)),a.innerHTML+=e,a.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),r(),o(e).then(function(t){}).catch(function(e){t.handler.debug(e)})}),i.appendChild(a),i}function a(){var t=document.createElement("li");return t.setAttribute("class","divider"),t.setAttribute("role","separator"),t}function u(t,e){var n=[],o=e.getParentContainer();return n.push(i(t,"Change style","wrench",function(n){var r,i=!1;return t.handler.getAllowedStyles(o.token,o.layoutId,e.id).then(function(a){var u=document.createElement("form"),s=document.createElement("select");u.appendChild(s);var l=!1;for(var c in a)(f=document.createElement("option")).value=c,f.innerHTML=a[c],s.appendChild(f),c===d.Item.DefaultStyle&&(l=!0);if(!l){var f=document.createElement("option");f.value=d.Item.DefaultStyle,f.innerHTML="Default",s.insertBefore(f,s.firstElementChild)}s.addEventListener("change",function(){r=s.value,i=!0}),h.createModal("Set style",u,n.pageX,n.pageY).then(function(){if(i)return t.handler.setStyle(o.token,o.layoutId,e.id,r).then(function(n){e.element.parentElement.replaceChild(n,e.element),t.init(n),t.initItem(n,o)})})})})),n.push(a()),n.push(i(t,"Remove","remove",function(){return t.handler.removeItem(o.token,o.layoutId,e.id).then(function(){t.remove(e.element)})})),n}function s(t,e){var n=[];return n.push(i(t,"Add column to left","chevron-left",function(){return t.handler.addColumn(e.token,e.layoutId,e.id,0).then(function(n){e.element.insertBefore(n,e.element.firstChild),t.init(n),t.initContainer(n,e)})})),n.push(i(t,"Add column to right","chevron-right",function(){var n=d.getContainerCount(e.element);return t.handler.addColumn(e.token,e.layoutId,e.id,n).then(function(n){e.element.appendChild(n),t.init(n),t.initContainer(n,e)})})),n.push(a()),n.push(i(t,"Remove","remove",function(){return t.handler.removeItem(e.token,e.layoutId,e.id).then(function(){t.remove(e.element)})})),n}function l(t,e){var n=[];return n.push(a()),n.push(i(t,"Add columns to top","columns",function(){return t.handler.addColumnContainer(e.token,e.layoutId,e.id,0).then(function(n){e.element.insertBefore(n,e.element.firstChild),t.init(n),t.initContainer(n,e)})})),n.push(i(t,"Add columns to bottom","columns",function(){var n=d.getContainerCount(e.element);return t.handler.addColumn(e.token,e.layoutId,e.id,n).then(function(n){e.element.appendChild(n),t.init(n),t.initContainer(n,e)})})),n.push(a()),n}function c(t,e){var n=l(t,e),o=e.getParentContainer();return n.push(a()),n.push(i(t,"Add column before","chevron-left",function(){return t.handler.addColumn(o.token,o.layoutId,o.id,e.getPosition()).then(function(n){o.element.insertBefore(n,e.element),t.init(n),t.initContainer(n,o)})})),n.push(i(t,"Add column after","chevron-right",function(){return t.handler.addColumn(o.token,o.layoutId,o.id,e.getPosition()+1).then(function(n){o.element.insertBefore(n,e.element.nextSibling),t.init(n),t.initContainer(n,o)})})),n.push(a()),n.push(i(t,"Remove this column","remove",function(){return t.handler.removeItem(e.token,e.layoutId,e.id).then(function(){t.remove(e.element)})})),n}Object.defineProperty(e,"__esModule",{value:!0});var d=n(0),h=n(8),f='<span class="fa fa-__GLYPH__" aria-hidden="true"></span> ',p='<div class="layout-menu" data-menu="1">\n  <a role="button" href="#" title="Click to open, double-click to expand/hide content">\n    <span class="fa fa-cog" aria-hidden="true"></span>\n    <span class="title">__TITLE__</span>\n  </a>\n  <ul></ul>\n</div>',m=[],y=!1,v=function(){function t(t,e){var n=this;this.item=t,this.element=e,this.master=e.querySelector("a"),this.master.addEventListener("dblclick",function(t){t.stopPropagation(),n.item.toggleCollapse()}),this.master.addEventListener("click",function(t){t.preventDefault(),n.open()})}return t.prototype.close=function(){var t=this.element.querySelector("ul");t&&(t.style.display="none")},t.prototype.open=function(){var t=this.element.querySelector("ul");t&&(t.style.display="block")},t}();e.createMenu=function(t,e){var n=[],r="Error";e instanceof d.Container?e.type===d.ContainerType.Column?(r="Column",n=c(t,e)):e.type===d.ContainerType.Horizontal?(r="Columns container",n=s(t,e)):(r="Layout",n=l(t,e)):(r="Item",n=u(t,e));var i=p.replace(new RegExp("__TITLE__","g"),r).replace("__LINKS__","<li><a>coucou</a></href>"),a=document.createElement("div");a.innerHTML=i;for(var h=a.firstElementChild,f=h.querySelector("ul"),b=0,g=n;b<g.length;b++){var C=g[b];f.appendChild(C)}y||(document.addEventListener("click",function(t){o(t)}),y=!0),m.push(new v(e,h)),e.element.insertBefore(h,e.element.firstChild)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o='<div class="layout-modal" tabindex="-1" role="dialog">\n  <div role="document">\n    <button name="close" type="button" aria-label="Close">\n      <span aria-hidden="true">&times;</span>\n    </button>\n    <h4 class="modal-title">__TITLE__</h4>\n    <div id="content"></div>\n  </div>\n</div>';e.createModal=function(t,e,n,r){return new Promise(function(i,a){var u=document.createElement("div");u.innerHTML=o.replace(new RegExp("__TITLE__","g"),t);var s=u.firstElementChild,l=s.querySelector("#content");l.parentElement.replaceChild(e,l),document.body.appendChild(s),s.style.display="block",s.style.position="absolute",s.style.left=n.toString()+"px",s.style.top=r.toString()+"px",s.style.transform="translate(-50%, -50%)",s.classList.add("open"),s.querySelector("button[name=close]").addEventListener("click",function(t){t.preventDefault(),s.remove(),i()})})}}]);